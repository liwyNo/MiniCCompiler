## Linear Scan 相关说明

---
###1. Linear Scan 概述

Linear Scan 是一种全局寄存器分配算法。相较于经典的图染色算法，Linear Scan 算法速度更快，图染色算法时间复杂度为 $O(N^4)$，而 Linear Scan 为 $O(NlogN)$。并且 Linear Scan 算法的分配效果与图染色算法相当，有时甚至更好。这正是我们选择使用 Linear Scan 算法的原因。

###2. 活性分析
由于 Linear Scan 也是要基于变量的活跃范围的，所以这里提一下活性分析的实现。
目前 MiniJava 使用的是找出变量的 DU (def-use) 链，然后建出 web 之间的干扰图。然而这部分实现起来难度很高。
我们采用的方法是在每个函数内部， 重复迭代 Eeyore 代码，更新每个变量的活跃区间，直到不再变化为止。注意，每个变量有一个活跃区间，区间左端点为 Eeyore 代码中最靠前的一条该变量活跃的指令，右端点为 Eeyore 代码中相应最靠后的指令，并不用拆分成更精确的小区间。
此方法虽然直观感觉比较浪费，但由于绝大多数变量活跃范围很小，所以实际效果良好。

###3. 算法流程
1. 求出变量活跃区间后，将它们按左端点排序。
2. 维护一个 active 队列，用于存放这些区间，队列内部，按区间右端点排序。
3. 同时维护每个寄存器对应的变量
4. 每次加入一个新的活跃区间时，先检查是否能从 active 队列中删掉右端点已经在当前新区间左端点的左端的区间,删除同时也意味着释放寄存器。
5. 然后考虑当前是否还有空闲的寄存器，若有，则分配给当前新的活跃区间，否则溢出 active 队列和新区间中右端点最大的区间。

###4.参考资料

本文档较为简略，且由于时间问题，缺少一个直观的例子说明。建议有兴趣的同学阅读一下官方文档，写的十分通俗易懂，且讨论了部分扩展内容。
https://www.cs.purdue.edu/homes/suresh/502-Fall2008/papers/linear-scan.pdf




